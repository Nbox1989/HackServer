<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Tables</title>

    <style type="text/css">
        #rootPath{
            font-size:30px;
            color: red;
            font-style:bold;
        }
        #relativePath{
            font-size:25px;
            color: blue;
            font-style:bold;
        }
    </style>
    <script>
        function setupParams() {
            var url = window.location.href;
            var queryString = url.split("?")[1];

            if (queryString) {
              var queryParams = queryString.split("&");

              var paramsObj = {};
              queryParams.forEach(function(param) {
                var keyValue = param.split("=");
                paramsObj[keyValue[0]] = decodeURIComponent(keyValue[1]);
              });

              databasePath = paramsObj.path;
              document.getElementById('file_path').innerText= databasePath;
            }
        }

        function initEvents(){
            document.getElementById('tables').addEventListener('change', function(event) {
                queryColumns(this.value);
            });
        }

        function queryTables(){
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function(){
                document.getElementById('tables').innerHTML=xhr.responseText;
            };
            xhr.open('get', './tables?path='+ window.databasePath, true);
            xhr.send();
        }

        function queryColumns(tableName) {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function(){
                var columns = xhr.responseText;
                var columnsTr = document.getElementById('columns');
                columnsTr.innerHTML=columns;
                queryRecords(tableName)
            };
            xhr.open('get', './columns?path='+ window.databasePath + '&table='+tableName, true);
            xhr.send();
        }

        function queryRecords(tableName){
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function(){
                document.getElementById('records').innerHTML=xhr.responseText;
            };
            xhr.open('get', './records?path='+ window.databasePath + '&table='+tableName, true);
            xhr.send();
        }

    </script>

    <script type='text/javascript'>
        window.onload = function () {
            setupParams();
            initEvents();
            queryTables();
        }
    </script>
</head>
<body>
    <div><h1 id="db_home_name">查看数据库信息：</h1></div>
    </br>
    <div>数据库路径：<span id="file_path"></span></span></div>
    </br>
    <div>选择表：<select id="tables"></select></div>
    </br>
    <table>
        <thead>
            <tr id="columns">
                <th>姓名</th>
                <th>年龄</th>
                <th>性别</th>
                <th>职业</th>
            </tr>
        </thead>
        <tbody id="records">
            <tr>
                <td>张三</td>
                <td>25</td>
                <td>男</td>
                <td>工程师</td>
            </tr>
            <tr>
                <td>李四</td>
                <td>32</td>
                <td>男</td>
                <td>教师</td>
            </tr>
            <tr>
                <td>王五</td>
                <td>28</td>
                <td>女</td>
                <td>医生</td>
            </tr>
        </tbody>
    </table>
</body>
</html>